<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>轮播</title>
    <style>
        /*
        * * 可以自定义carousel-container布局来实现轮播的不同布局效果：全屏宽度，或者是居中布局看自己需要，响应式也是可以直接控制这里，因为其他地方的宽度是无法修改的
        *
        */
        .carousel-container {
            width: 900px;
            /*默认*/
            height: 450px;
            /*默认*/
            margin: 0 auto;
            overflow: hidden;
        }

        .carousel-container .carousel-wrap {
            height: 100%;
            position: relative;

        }

        .carousel-container .carousel-wrap .carousel-item {
            height: 100%;
            float: left;
        }

        .carousel-container .carousel-wrap .carousel-item img {
            width: 100%;
            height: 100%;
            border: 1px solid #cccccc;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <div>
        <div class="carousel-container" id="carousel-container">
            <!-- ! 不能直接改carousel-item的宽度，它的宽度是相对于carousel-container来计算的，所以如果真的需要控制轮播图片宽度大小的话是直接修改容器的carousel-container的宽度，而carousel-item是百分比的carousel-container宽度大小 .carousel-wrap的宽度是根据carousel-item来计算的，而且采用的是carousel-item的offsetWidth进行计算：算上了padding、border、margin，如果不算margin的话采用其他属性 -->
            <div class="carousel-wrap" id="carousel-wrap">
                <div class="carousel-item" data-name="name">
                    <img src="./imgs/1.jpg" alt="轮播" />
                </div>
                <div class="carousel-item">
                    <img src="./imgs/2.jpg" alt="轮播" />
                </div>
                <div class="carousel-item">
                    <img src="./imgs/3.jpg" alt="轮播" />
                </div>
                <div class="carousel-item">
                    <img src="./imgs/4.jpg" alt="轮播" />
                </div>

                <!-- * 最后一个添加一个重复第一张的div结构，以实现无限滚动，默认是开启无限滚动的也就是会在js层加上一个重复第一个item的结构。 -->
            </div>
        </div>
    </div>
    <div><button id="left-arrow">左移动</button></div>

    <script>
        /**
         * @description:轮播构建函数 
         * @param {type} 
         * @return: 
         */
        function carousle(option) {
            // 初始化轮播容器的宽度
            let optionDefault = {
                loop: false,
            }
            option = Object.assign(optionDefault, option);
            console.log(option);
            let carouselWrap = document.getElementById('carousel-wrap');
            let carouselItem = document.getElementsByClassName('carousel-item');
            if (option.loop) {
                // 开启loop模式，所以需要再追加一个同第一个item重复的div结构 
                let cloneNode = carouselItem[0].cloneNode(true);
                carouselWrap.appendChild(cloneNode);

            }
            let len = carouselItem.length;
            console.log(len);
            let containerWidth = document.getElementById('carousel-container').offsetWidth;
            for (let i = 0; i < len; i++) {
                carouselItem[i].style.width = containerWidth + 'px';
            }
            carouselWrap.style.width = containerWidth * len + 'px';
            var letfMove = document.getElementById('left-arrow');
            // letfMove.onclick = function () {
            //     carouselWrap.style.left = -containerWidth + 'px'
            // }
            let leftSize = 0;
            let count = 1;
            let isEnd = false;
            let s1 = setInterval(() => {
                if (!isEnd) {
                    let s2 = setInterval(() => {
                        //判断是否滚动完了一张
                        if (leftSize <= -containerWidth * count) {
                            carouselWrap.style.left = -containerWidth * count + 'px';
                            count++;
                            clearInterval(s2);
                            // 完全到达了最后一张了：或者是到达了loop的重复那一张也就是第一张
                            // if (count === len + 1) {
                            //     if (option.loop) {
                            //         // ?安
                            //         leftSize = 0; //之后重新开始计时滚动滚动
                            //         count = 1;
                            //         carouselWrap.style.left = '0px';
                            //         console.log(carouselWrap.style.left);
                            //         return;
                            //     } else {
                            //         // 快速滚到第一张
                            //         alert(0)
                            //         isEnd = true;

                            //     }
                            // }
                            return;
                        }
                        console.log(count);
                        if (count === len) {
                            // 阻止到终点后错误偏移
                            clearInterval(s2);
                            if (option.loop) {
                                // ?安
                                leftSize = 0; //之后重新开始计时滚动滚动
                                count = 1;
                                carouselWrap.style.left = '0px';
                                console.log(carouselWrap.style.left);
                                return;
                            } else {
                                // 快速滚到第一张
                                isEnd = true;

                            }
                            return;
                        }
                        leftSize -= containerWidth / 10;
                        // console.log(leftSize)
                        carouselWrap.style.left = leftSize + 'px';
                    }, 60);
                } else {
                    // !不开启loop且已经滚动到最后一张,此时快速滚动到第一张
                    var s3 = setInterval(() => {
                        if (leftSize > -5) {
                            leftSize = 0;
                            carouselWrap.style.left = leftSize + 'px';
                            clearInterval(s3);
                            isEnd = false;
                            count = 1;
                            return;
                        }

                        leftSize += containerWidth / 10;
                        carouselWrap.style.left = leftSize + 'px';
                    }, 10);
                }


            }, 2000)
        }
        // 不开启loop
        carousle({
            loop: false
        });
        // TODO:LOOP配置已经可以了，接下来是左右点击，以及下标圆圈点击。
    </script>
</body>

</html>